<?xml version="1.0" encoding="UTF-8"?>
<ContentView
    x:Class="SpiritualGiftsTest.Views.Controls.ASLabelCell"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    x:Name="Self">

    <!-- single tap recognizer wired to your Command DP -->
    <ContentView.GestureRecognizers>
        <TapGestureRecognizer
            Command="{Binding Command, Source={x:Reference Self}}"
            CommandParameter="{Binding ., Source={x:Reference Self}}" />
    </ContentView.GestureRecognizers>

    <Grid
      HorizontalOptions="Fill"
      VerticalOptions="Fill"
      MinimumHeightRequest="40">

        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="0.25*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="0.5*" />
            <ColumnDefinition Width="0.4*" />
            <ColumnDefinition Width="0.1*" />
        </Grid.ColumnDefinitions>

        <!-- Title + required star -->
        <StackLayout
            Orientation="Horizontal"
            Grid.Row="0"
            Grid.RowSpan="2"
            Grid.Column="0"
            VerticalOptions="Center"
            HorizontalOptions="Start"
            Margin="20,-5,0,0">
            <Label
              x:Name="TitleLabel"
              Text="{Binding Title, Source={x:Reference Self}}"
              FontSize="{OnIdiom Phone=14, Tablet=20}"
              FontAttributes="Bold" />
            <Label
              Text="*"
              TextColor="Red"
              IsVisible="{Binding IsRequired, Source={x:Reference Self}}" />
        </StackLayout>

        <!-- Detail text -->
        <Label
            x:Name="DetailLabel"
            Grid.Row="0" Grid.RowSpan="2"
            Grid.Column="1"
            Text="{Binding Detail, Source={x:Reference Self}}"
            TextColor="{StaticResource PrimaryTextColor}"
            VerticalOptions="Center"
            HorizontalOptions="End"
            FontSize="{OnIdiom Phone=14, Tablet=20}"
            LineBreakMode="WordWrap" />

        <!-- Chevron, hidden in read‐only mode -->
        <ImageButton
            x:Name="Chevron"
            Grid.Row="0" Grid.RowSpan="2"
            Grid.Column="2"
            Source="{StaticResource ChevronRight}"
            HeightRequest="30"
            WidthRequest="30"
            Margin="0,-5,20,0"
            IsVisible="{Binding IsReadOnly, Source={x:Reference Self}, Converter={StaticResource InverseBool}}" />

        <!-- Error message, only visible when non‐empty -->
        <Label
            x:Name="ErrorLabel"
            Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
            Text="{Binding Error, Source={x:Reference Self}}"
            TextColor="Red"
            Margin="20,22,0,0"
            FontSize="12"
            IsVisible="{Binding Error, Source={x:Reference Self}, Converter={StaticResource StringNotNullOrEmpty}}" />

        <!-- full‐cell tappable overlay -->
        <Border
            StrokeThickness="0"
            BackgroundColor="Transparent"
            Grid.Row="0" Grid.RowSpan="2"
            Grid.Column="0" Grid.ColumnSpan="3" />

        <!-- bottom divider, hidden on last cell -->
        <BoxView
            x:Name="divider"
            Grid.Row="1" Grid.Column="0" Grid.ColumnSpan="3"
            HeightRequest="0.5"
            BackgroundColor="Gray"
            HorizontalOptions="Fill"
            VerticalOptions="End"
            IsVisible="{Binding IsLastCell, Source={x:Reference Self}, Converter={StaticResource InverseBool}}" />

    </Grid>
</ContentView>
