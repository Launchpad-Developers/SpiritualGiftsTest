<?xml version="1.0" encoding="UTF-8" ?>
<views:BasePage  
    x:Class="SpiritualGiftsTest.Views.Survey.SurveyPage"  
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"  
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"  
    xmlns:views="clr-namespace:SpiritualGiftsTest.Views.Shared;assembly=SpiritualGiftsTest"  
    xmlns:vm="clr-namespace:SpiritualGiftsTest.Views.Survey;assembly=SpiritualGiftsTest"  
    xmlns:c="clr-namespace:SpiritualGiftsTest.Views.Controls;assembly=SpiritualGiftsTest"
    xmlns:ios="clr-namespace:Microsoft.Maui.Controls.PlatformConfiguration.iOSSpecific;assembly=Microsoft.Maui.Controls"
    ios:NavigationPage.HideNavigationBarSeparator="true"  
    x:DataType="vm:SurveyViewModel"
    NavigationPage.HasBackButton="False"  
    FlowDirection="{Binding FlowDirection}">

    <NavigationPage.TitleView>
        <StackLayout Orientation="Horizontal" HorizontalOptions="Fill" BackgroundColor="Transparent">
            <ImageButton 
                x:Name="BackArrow"
                HorizontalOptions="Start"
                VerticalOptions="Center"
                WidthRequest="50"
                HeightRequest="25"
                BackgroundColor="Transparent"
                Source="{StaticResource BackArrow}"
                Command="{Binding NavButtonCommand}" />
            <c:TitleLabel 
                NewStyle="{StaticResource NavTitleLabelStyle}"
                HorizontalOptions="Fill"
                FlowDirection="{Binding FlowDirection}"
                LabelText="{Binding PageTopic}" />
            <ImageButton 
                x:Name="BackArrowRight"
                HorizontalOptions="End"
                VerticalOptions="Center"
                WidthRequest="50"
                HeightRequest="25"
                IsVisible="False"
                IsEnabled="False"
                BackgroundColor="Transparent"
                Source="{StaticResource BackArrowRight}"
                Command="{Binding NavButtonCommand}" />
        </StackLayout>
    </NavigationPage.TitleView>

    <ContentPage.Content>
        <Grid 
            x:Name="MainLayout"
            RowDefinitions="*,Auto">

            <!-- Background Image spans all rows -->
            <Image 
                x:Name="BackgroundImage"
                Source="mainpagebackground"
                Aspect="Fill"
                Grid.RowSpan="2"
                HorizontalOptions="Fill"
                VerticalOptions="Fill" />

            <!-- Navigation Layout -->
            <Grid 
                x:Name="NavLayout"
                IsVisible="False"
                Grid.Row="1"
                ColumnDefinitions="Auto,*,Auto"
                Padding="10"
                BackgroundColor="Transparent">

                <!-- Left Button -->
                <ImageButton 
                    Grid.Column="0"
                    x:Name="LeftButton"
                    WidthRequest="{OnIdiom Phone='50', Tablet='70'}"
                    HeightRequest="{OnIdiom Phone='50', Tablet='70'}"
                    CornerRadius="{OnIdiom Phone='25', Tablet='35'}"
                    Source="{StaticResource NavLeft}"
                    BackgroundColor="Transparent"
                    Padding="10"
                    VerticalOptions="Center"
                    HorizontalOptions="Start"
                    Command="{Binding NavigateCommand}"
                    CommandParameter="Previous" />

                <!-- Pager -->
                <Border 
                    Grid.Column="1"
                    WidthRequest="150"
                    HeightRequest="{OnIdiom Phone=30, Tablet=40}"
                    Stroke="Gray"
                    StrokeThickness="1"
                    StrokeShape="{RoundRectangle CornerRadius={OnIdiom Phone=15, Tablet=20}}"
                    HorizontalOptions="Center"
                    VerticalOptions="Center">
                    <Label 
                        Text="{Binding PageOf}"
                        Opacity="0.25"
                        HorizontalOptions="Center"
                        VerticalOptions="Center"/>
                </Border>

                <!-- Right Button -->
                <ImageButton 
                    Grid.Column="2"
                    x:Name="RightButton"
                    WidthRequest="{OnIdiom Phone='50', Tablet='70'}"
                    HeightRequest="{OnIdiom Phone='50', Tablet='70'}"
                    CornerRadius="{OnIdiom Phone='25', Tablet='35'}"
                    Source="{StaticResource NavRight}"
                    BackgroundColor="Transparent"
                    Padding="10"
                    VerticalOptions="Center"
                    HorizontalOptions="End"
                    Command="{Binding NavigateCommand}"
                    CommandParameter="Next" />

            </Grid>

            <!-- Loading overlay background (covers entire Grid) -->
            <ContentView 
                x:Name="loadingBackground"
                BackgroundColor="#222222"
                Opacity="0.65"
                IsVisible="True"
                Grid.RowSpan="2" />

            <!-- Loading message centered (covers entire Grid) -->
            <StackLayout 
                x:Name="loadingMessage"
                Orientation="Vertical"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                Grid.RowSpan="2">
                <ActivityIndicator IsRunning="True" Color="{StaticResource WhiteSmoke}" />
                <Label 
                    Text="{Binding LoadingText}" 
                    HorizontalOptions="Center" 
                    TextColor="{StaticResource WhiteSmoke}" />
            </StackLayout>

        </Grid>
    </ContentPage.Content>

</views:BasePage>
