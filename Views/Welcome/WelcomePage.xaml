<?xml version="1.0" encoding="utf-8" ?>
<views:BasePage
    x:Class="SpiritualGiftsTest.Views.Welcome.WelcomePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:views="clr-namespace:SpiritualGiftsTest.Views.Shared;assembly=SpiritualGiftsTest"
    xmlns:vm="clr-namespace:SpiritualGiftsTest.Views.Welcome;assembly=SpiritualGiftsTest"
    xmlns:c="clr-namespace:SpiritualGiftsTest.Views.Controls;assembly=SpiritualGiftsTest"
    NavigationPage.HasBackButton="False"
    FlowDirection="{Binding FlowDirection}">

    <NavigationPage.TitleView>
        <StackLayout Orientation="Horizontal" HorizontalOptions="Fill" FlowDirection="LeftToRight" BackgroundColor="Transparent">
            <ImageButton 
                HorizontalOptions="Start"
                VerticalOptions="Center"
                WidthRequest="50"
                HeightRequest="25"
                BackgroundColor="Transparent"
                IsVisible="{Binding ShowControls}"
                Source="{StaticResource Settings}"
                Command="{Binding OpenSettings}"/>
            <c:TitleLabel 
                NewStyle="{StaticResource NavTitleLabelStyle}"
                HorizontalOptions="Fill"
                LabelText="{Binding PageTopic}"
                FlowDirection="{Binding FlowDirection}" />
            <ImageButton 
                HorizontalOptions="End"
                VerticalOptions="Center"
                BackgroundColor="Transparent"
                WidthRequest="50"
                HeightRequest="25"
                IsVisible="{Binding ShowControls}"
                Source="{StaticResource Info}"
                Command="{Binding OpenInfo}"/>
        </StackLayout>
    </NavigationPage.TitleView>

    <ContentPage.Content>
        <Grid x:Name="MainLayout">

            <!-- Background Image -->
            <Image 
                Source="mainpagebackground"
                Aspect="Fill"
                HorizontalOptions="Fill"
                VerticalOptions="Fill" />

            <!-- QuestionView centered vertically at 30% -->
            <c:QuestionView 
                x:Name="scriptureView"
                Question="{Binding Question}"
                IsVisible="{Binding ShowControls}"
                HorizontalOptions="Center"
                VerticalOptions="Start"
                Margin="0"
                TranslationY="{OnIdiom Phone='{Binding RelativeTranslationY}', Tablet='{Binding RelativeTranslationY}'}" />

            <!-- Nav Button centered -->
            <ImageButton
                Command="{Binding NavButtonCommand}"
                CommandParameter="{Binding NextPage}"
                HorizontalOptions="Center"
                VerticalOptions="Center"
                IsVisible="{Binding IsLoading, Converter={StaticResource NegatedConverter}}"
                WidthRequest="100"
                HeightRequest="100"
                Source="{StaticResource YourNavIcon}" />

            <!-- Loading overlay background -->
            <ContentView 
                x:Name="loadingBackground"
                BackgroundColor="#222222"
                Opacity="0.65"
                IsVisible="{Binding IsLoading}" />

            <!-- Loading spinner/message centered -->
            <StackLayout 
                Orientation="Vertical"
                IsVisible="{Binding IsLoading}"
                WidthRequest="300"
                HeightRequest="100"
                HorizontalOptions="Center"
                VerticalOptions="Center">
                <ActivityIndicator IsRunning="True" Color="{StaticResource WhiteSmoke}" />
                <Label 
                    Text="{Binding LoadingText}"
                    HorizontalOptions="Center"
                    TextColor="{StaticResource WhiteSmoke}" />
            </StackLayout>

            <!-- Instructable overlay background -->
            <ContentView 
                x:Name="instructableBackground"
                BackgroundColor="#222222"
                Opacity="0.85"
                IsVisible="{Binding ShowInstructable}" />

            <!-- Instructable overlay content centered -->
            <StackLayout 
                Orientation="Vertical"
                IsVisible="{Binding ShowInstructable}"
                WidthRequest="{OnIdiom Phone=300, Tablet=500}"
                HeightRequest="{OnIdiom Phone=500, Tablet=700}"
                HorizontalOptions="Center"
                VerticalOptions="Center">

                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="50" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="33*" />
                        <ColumnDefinition Width="34*" />
                        <ColumnDefinition Width="33*" />
                    </Grid.ColumnDefinitions>

                    <Label 
                        Text="{Binding TapTo}"
                        Style="{StaticResource InstructableLabelStyle}"
                        Grid.Row="0" />

                    <StackLayout 
                        Grid.Row="1" Grid.Column="0"
                        Margin="10,0,0,0"
                        HorizontalOptions="Start"
                        Orientation="Horizontal"
                        HeightRequest="96">
                        <Image 
                            Source="{StaticResource NavLeftWhite}"
                            HeightRequest="{OnIdiom Phone=75, Tablet=150}"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            Aspect="AspectFit" />
                    </StackLayout>

                    <StackLayout 
                        Grid.Row="1" Grid.Column="1"
                        HorizontalOptions="Center"
                        Orientation="Horizontal"
                        HeightRequest="96">
                        <Image 
                            Source="{StaticResource Swipe}"
                            HeightRequest="{OnIdiom Phone=50, Tablet=100}"
                            Margin="0,25,0,0"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            Aspect="AspectFit" />
                    </StackLayout>

                    <StackLayout 
                        Grid.Row="1" Grid.Column="2"
                        Margin="0,0,10,0"
                        HorizontalOptions="End"
                        Orientation="Horizontal"
                        HeightRequest="96">
                        <Image 
                            Source="{StaticResource NavRightWhite}"
                            HeightRequest="{OnIdiom Phone=75, Tablet=150}"
                            HorizontalOptions="Center"
                            VerticalOptions="Center"
                            Aspect="AspectFit" />
                    </StackLayout>

                    <Label 
                        Text="{Binding Navigate}"
                        Style="{StaticResource InstructableLabelStyle}"
                        Grid.Row="2" />

                    <Button 
                        Grid.Row="4" Grid.Column="0" Grid.ColumnSpan="3"
                        Command="{Binding ConfirmCommand}"
                        CommandParameter="{Binding NextPage}" />
                </Grid>
            </StackLayout>

        </Grid>
    </ContentPage.Content>

</views:BasePage>